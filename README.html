<h1>🚀 Async gRPC ↔ Ragflow Integration</h1>
<p>This repository contains an <strong>asynchronous gRPC server-client system</strong> integrated with 3 <strong>Ragflow’s HTTP endpoints</strong>.</p>
<p>It provides a structured approach for connecting backend services to Ragflow’s AI-based retrieval and reasoning capabilities through fast, concurrent gRPC communication. These can be readily extended to the HTTP endpoints mentioned in <a href="https://ragflow.io/docs/dev/http_api_reference">Ragflow docs</a></p>
<p>The system is containerized with <strong>Docker Compose</strong>, enabling quick local setup and deployment.</p>
<hr />
<h2>🧭 Overview</h2>
<p>The project bridges <strong>gRPC-based microservices</strong> and <strong>Ragflow’s REST API</strong>.
This project demonstrates the barebones of how to have an asnchronous gRPC server and client commincate with 3 of Ragflow's endpoints- namely:
- register a new user,
- login,
- generate a new api token for a given user.</p>
<p>Given this implementation, it can be seemlessly developed to incorporate more of Ragflow's HTTP endpoints.</p>
<hr />
<h2>🧱 Project Structure</h2>
<p>The project uses Ragflows modules and files and therefore the system requirements are similar to that of Ragflow's with certain additional dependencies(ref). Apart from a few changes to Ragflow's files the main files are located within <code>ragflow_grpc/grpc_ext</code>.
<code>grpc_ext/
├── Dockerfile
├── docs
├── grpc_server
├── README.md
└── requirements.txt</code></p>
<hr />
<h2>⚙️ System Requirements</h2>
<p>The hardware system requirements for running Ragflow are given in <a href="../README_RAG.html">README_RAG.html</a> (Refer to the Get Started section...)
The Makefile in ragflow/ will make sure your system meets the following requirements in a uv virtual environment.</p>
<p>| Component | Minimum Version | Notes |
|------------|----------------|-------|
| <strong>Python</strong> | 3.10 | AsyncIO and grpc.aio features required |
| <strong>Docker</strong> | 28.5.0 | For containerization and orchestration |
| <strong>Docker Compose</strong> | v2.40.0| For multi-container setup |
| <strong>grpcio / grpcio-tools</strong> | 1.63.0| For gRPC functionality |</p>
<hr />
<h2>⚙️ Usage guide</h2>
<h3>Setting up the System</h3>
<p>To install, run from the projects root folder <code>ragflow_grpc/</code>:
<code>make setup</code></p>
<p>This installs:
- uv and a virtual environment for the project
- python=3.10 and pins it to it
- dependencies from requirements-dev.txt and grpc_ext/requirements.txt
- pre-commit hooks
- turns down docker launched servers if any and removes orphans
- builds no-cache docker container images using docker-compose-grpc.yml in ragflow/docker/</p>
<h3>Starting the System</h3>
<p>To startup the servers, run from the root folder ragflow/:
<code>make up</code></p>
<p>This:
- launches the docker containers built earlier via docker compose using the same docker-compose-grpc.yml in ragflow/docker/
- runs pytest to test for HTTP endpoints of Ragflow accessed by the gRPC server and
- gRPC client methods for communicating with Ragflow.</p>
<h3>Stopping the System</h3>
<p>To shutdown, run:
<code>make down</code></p>
<p>This:
- turns down all docker launched servers any and removes orphans</p>
<h2>🌐 Integration Flow</h2>
<ol>
<li><strong>gRPC Client</strong> sends a structured or natural-language query via gRPC.</li>
<li><strong>gRPC Server</strong> receives the request, processes it asynchronously, and calls relevant Ragflow’s HTTP endpoint.</li>
<li><strong>Ragflow Server</strong> returns a structured or text-based response at its endpoint.</li>
<li><strong>gRPC Server</strong> sends this result back to the <strong>grpc Client</strong> through gRPC.</li>
</ol>
<hr />
<h2>🔍 Configuration Files</h2>
<h3><code>docker/docker-compose-grpc.yml</code></h3>
<p>Modified .yml lauches gRPC and Ragflow servers.
The environment variables are defined in <code>docker/.env</code> file.</p>
<h4>Ports</h4>
<p>The gRPC server uses port <code>50051</code> and connects internally to <code>http://ragflow:9380</code> to access Ragflow's ports.
Ragflow end points can be accessed via <code>SVR_HTTP_PORT=9380</code> defined in <code>docker/.env</code>.
The access to Ragflow's UI can be obtained from <code>http://localhost:9380</code>.</p>
<h4>Dockerfile for gRPC</h4>
<p>This is located in <code>grpc_ext/</code> and is accessed by <code>docker/docker-compose-grpc.yml</code> to launch a gRPC service named <code>ragflow-grpc-server</code>.</p>
<h3><code>docker/docker-compose.yml</code></h3>
<p>Original(unchanged) Ragflow docker-compose.yml file, can be used to deploy only Ragflow services.</p>
<h3><code>grpc_ext/requirements.txt</code></h3>
<p>Contains modules for gRPC operation.</p>
<h3><code>requirements-dev.txt</code></h3>
<p>Contains developer related modules.</p>
<hr />
<h2>🖥️ gRPC Server</h2>
<p>These files are located in <code>grpc_ext/grpc_server</code></p>
<p>These include:
- <code>grpc_async_server_ragserve.py</code> run by the docker file and launched by <code>docker/docker-compose-grpc.yml</code>.
- <code>grpc_async_server_ragserve_ext.py</code> a copy of the above file but runs (if launched) on port <code>50061</code>.</p>
<h2>🤝 gRPC Client</h2>
<p>These files are also located in <code>grpc_ext/grpc_server</code></p>
<p>These include:
- <code>grpc_async_ragclient.py</code> and can be run via <code>un run python grpc_async_ragclient.py</code> and containe gRPC client functions.
- <code>grpc_async_ragclient_test.py</code> used by pytest for testing <code>grpc_async_ragclient.py</code> functions with all servers up.</p>
<h2>🧪 Testing</h2>
<p>These can be excuted from <code>ragflow_grpc/</code>
<code>make test</code></p>
<h3>Test files</h3>
<p>These are located in <code>grpc_ext/grpc_server</code>
These include:
- <code>endpoint_test.py</code> which tests Ragflow's endpoints accessed by the gRPC server.
- <code>grpc_async_ragclient_test.py</code> used by pytest for testing <code>grpc_async_ragclient.py</code> functions with all servers up.</p>
<hr />
<h2>📘⚙️ Docs related to gRPC services</h2>
<p>Sphinx like docs can be found in 📚 <a href="http://rawcdn.githack.com/roninrp/ragflow_grpc/main/grpc_ext/docs/_build/html/index.html">grpc_ext/docs/_build/html/index.html</a> <code>grpc_ext/docs/_build/html/index.html</code>.</p>
<p>These are placed in <code>grpc_ext/docs</code> and can be generated for the documentation in <code>grpc_ext/</code> by running
<code>make docs</code>
from the root folder (<code>ragflow_grpc</code>) and can be found in <code>grpc_ext/docs/_build/html/index.html</code>.</p>
